<script type="text/javascript">
    RED.nodes.registerType('tuya-file-decrypt', {
        category: 'Tuya',
        color: '#00aaff',
        defaults: {
            name: {value:""},
            accessId: {value:""},
            accessKey: {value:""},
            region: {value:"eu-central-1"},
            deviceId: {value:""}
        },
        inputs: 1,
        outputs: 1,
        icon: "tuya-file-decrypt.svg",
        label: function() {
            return this.name || "Tuya File Decrypt (S3)";
        }
    });
</script>

<script type="text/x-red" data-template-name="tuya-file-decrypt">
    <div class="form-row">
        <label for="node-input-accessId"><i class="fa fa-key"></i> Access ID</label>
        <input type="text" id="node-input-accessId">
    </div>
    
    <div class="form-row">
        <label for="node-input-accessKey"><i class="fa fa-lock"></i> Access Key</label>
        <input type="text" id="node-input-accessKey">
    </div>
    
    <div class="form-row">
        <label for="node-input-region"><i class="fa fa-globe"></i> S3 Region</label>
        <select id="node-input-region">
            <!-- Europe -->
            <option value="eu-central-1">eu-central-1 (Frankfurt)</option>
            <option value="eu-west-1">eu-west-1 (Ireland)</option>
            <option value="eu-west-2">eu-west-2 (London)</option>
            <option value="eu-west-3">eu-west-3 (Paris)</option>
            <option value="eu-north-1">eu-north-1 (Stockholm)</option>
            <option value="eu-south-1">eu-south-1 (Milan)</option>
            <option value="eu-south-2">eu-south-2 (Spain)</option>

            <!-- North America -->
            <option value="us-east-1">us-east-1 (N. Virginia)</option>
            <option value="us-east-2">us-east-2 (Ohio)</option>
            <option value="us-west-1">us-west-1 (N. California)</option>
            <option value="us-west-2">us-west-2 (Oregon)</option>
            <option value="ca-central-1">ca-central-1 (Canada Central)</option>

            <!-- South America -->
            <option value="sa-east-1">sa-east-1 (São Paulo)</option>

            <!-- Asia Pacific -->
            <option value="ap-northeast-1">ap-northeast-1 (Tokyo)</option>
            <option value="ap-northeast-2">ap-northeast-2 (Seoul)</option>
            <option value="ap-northeast-3">ap-northeast-3 (Osaka)</option>
            <option value="ap-southeast-1">ap-southeast-1 (Singapore)</option>
            <option value="ap-southeast-2">ap-southeast-2 (Sydney)</option>
            <option value="ap-southeast-3">ap-southeast-3 (Jakarta)</option>
            <option value="ap-southeast-4">ap-southeast-4 (Melbourne)</option>
            <option value="ap-south-1">ap-south-1 (Mumbai)</option>
            <option value="ap-south-2">ap-south-2 (Hyderabad)</option>
            <option value="ap-east-1">ap-east-1 (Hong Kong)</option>

            <!-- Middle East / Africa -->
            <option value="me-south-1">me-south-1 (Bahrain)</option>
            <option value="me-central-1">me-central-1 (UAE)</option>
            <option value="af-south-1">af-south-1 (Cape Town)</option>

            <!-- China (domain .com.cn) -->
            <option value="cn-north-1">cn-north-1 (Beijing)</option>
            <option value="cn-northwest-1">cn-northwest-1 (Ningxia)</option>
        </select>
    </div>
    
    <div class="form-row">
        <label for="node-input-deviceId"><i class="fa fa-cube"></i> Device ID</label>
        <input type="text" id="node-input-deviceId">
    </div>
</script>

<script type="text/x-red" data-help-name="tuya-file-decrypt">
    <p>A Node‑RED node that decrypts Tuya movement‑config encrypted files (AES‑CBC) and returns the resulting image as Base64 or binary Buffer.</p>
</script>

<script type="text/x-red" data-help-name="tuya-file-decrypt">
    <p>
        Node that takes a Base64-encoded Tuya JSON payload containing
        <code>bucket</code>, <code>files</code> and an AES key, builds a direct S3 URL,
        downloads the encrypted file and returns the decrypted image as Base64 and Buffer.
    </p>
</script>
