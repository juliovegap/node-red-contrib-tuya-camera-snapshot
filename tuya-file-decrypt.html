<script type="text/javascript">
    RED.nodes.registerType('tuya-file-decrypt', {
        category: 'Tuya',
        color: '#00aaff',
        defaults: {
            name: {value:""},
            accessId: {value:""},
            accessKey: {value:""},
            endpoint: {value:""},
            deviceId: {value:""}
        },
        inputs: 1,
        outputs: 1,
        icon: "tuya-file-decrypt.svg",
        label: function() {
            return this.name || "Tuya File Decrypt (S3)";
        }
    });
</script>

<script type="text/x-red" data-template-name="tuya-file-decrypt">
    <div class="form-row">
        <label for="node-input-accessId"><i class="fa fa-key"></i> Access ID</label>
        <input type="text" id="node-input-accessId">
    </div>
    
    <div class="form-row">
        <label for="node-input-accessKey"><i class="fa fa-lock"></i> Access Key</label>
        <input type="text" id="node-input-accessKey">
    </div>

    <div class="form-row">
    <label for="node-input-endpoint"><i class="fa fa-globe"></i> Endpoint</label>
        <select id="node-input-endpoint">
            <option value="https://openapi.tuyaeu.com">Central Europe Data Center</option>
            <option value="https://openapi-weaz.tuyaeu.com">Western Europe Data Center</option>
            <option value="https://openapi.tuyaus.com">Western America Data Center</option>
            <option value="https://openapi-ueaz.tuyaus.com">Eastern America Data Center</option>
            <option value="https://openapi.tuyain.com">India Data Center</option>
            <option value="https://openapi.tuyacn.com">China Data Center</option>
            <option value="https://openapi-sg.iotbing.com">Singapore Data Center</option>
        </select>
    </div>

    <div class="form-row">
        <label for="node-input-deviceId"><i class="fa fa-cube"></i> Device ID</label>
        <input type="text" id="node-input-deviceId">
    </div>
</script>

<script type="text/x-red" data-help-name="tuya-file-decrypt">
    <p>A Node‑RED node that decrypts Tuya movement‑config encrypted files (AES‑CBC) and returns the resulting image as Base64 or binary Buffer.</p>
</script>

<script type="text/x-red" data-help-name="tuya-file-decrypt">
    <p>
        Node that takes a Base64-encoded Tuya JSON payload containing
        <code>bucket</code>, <code>files</code> and an AES key, builds a direct S3 URL,
        downloads the encrypted file and returns the decrypted image as Base64 and Buffer.
    </p>
</script>
